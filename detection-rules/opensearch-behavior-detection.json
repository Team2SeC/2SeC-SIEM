{
  "detection_rules": {
    "metadata": {
      "version": "1.0",
      "description": "2SeC SIEM OpenSearch Behavior-based Detection Rules (Level 2)",
      "created": "2026-01-02",
      "index_pattern": "2sec-siem-*"
    },
    "rules": [
      {
        "rule_id": "BEHAVIOR-SQLI-001",
        "name": "Repeated SQL Injection Attempts",
        "description": "동일 IP에서 1분 내 10회 이상 SQL Injection 시도 탐지",
        "severity": "high",
        "category": "Injection",
        "query": {
          "bool": {
            "must": [
              {
                "term": {
                  "attack.rule_id": "WEB-SQLI-001"
                }
              }
            ],
            "filter": [
              {
                "range": {
                  "@timestamp": {
                    "gte": "now-1m"
                  }
                }
              }
            ]
          }
        },
        "aggregation": {
          "terms": {
            "field": "source.ip",
            "min_doc_count": 10
          }
        },
        "actions": {
          "alert": true,
          "index": "2sec-siem-alerts",
          "notification": {
            "channels": ["security-alerts"],
            "priority": "high"
          }
        }
      },
      {
        "rule_id": "BEHAVIOR-XSS-001",
        "name": "Repeated XSS Attempts",
        "description": "동일 IP에서 1분 내 10회 이상 XSS 시도 탐지",
        "severity": "high",
        "category": "Client-Side",
        "query": {
          "bool": {
            "must": [
              {
                "term": {
                  "attack.rule_id": "WEB-XSS-001"
                }
              }
            ],
            "filter": [
              {
                "range": {
                  "@timestamp": {
                    "gte": "now-1m"
                  }
                }
              }
            ]
          }
        },
        "aggregation": {
          "terms": {
            "field": "source.ip",
            "min_doc_count": 10
          }
        },
        "actions": {
          "alert": true,
          "index": "2sec-siem-alerts",
          "notification": {
            "channels": ["security-alerts"],
            "priority": "high"
          }
        }
      },
      {
        "rule_id": "BEHAVIOR-CMD-001",
        "name": "Repeated Command Injection Attempts",
        "description": "동일 IP에서 1분 내 10회 이상 Command Injection 시도 탐지",
        "severity": "critical",
        "category": "Injection",
        "query": {
          "bool": {
            "must": [
              {
                "term": {
                  "attack.rule_id": "WEB-CMD-001"
                }
              }
            ],
            "filter": [
              {
                "range": {
                  "@timestamp": {
                    "gte": "now-1m"
                  }
                }
              }
            ]
          }
        },
        "aggregation": {
          "terms": {
            "field": "source.ip",
            "min_doc_count": 10
          }
        },
        "actions": {
          "alert": true,
          "index": "2sec-siem-alerts",
          "notification": {
            "channels": ["security-alerts", "security-critical"],
            "priority": "critical"
          }
        }
      },
      {
        "rule_id": "BEHAVIOR-PATH-001",
        "name": "Repeated Path Traversal Attempts",
        "description": "동일 IP에서 1분 내 10회 이상 Path Traversal 시도 탐지",
        "severity": "high",
        "category": "File Access",
        "query": {
          "bool": {
            "must": [
              {
                "term": {
                  "attack.rule_id": "WEB-PATH-001"
                }
              }
            ],
            "filter": [
              {
                "range": {
                  "@timestamp": {
                    "gte": "now-1m"
                  }
                }
              }
            ]
          }
        },
        "aggregation": {
          "terms": {
            "field": "source.ip",
            "min_doc_count": 10
          }
        },
        "actions": {
          "alert": true,
          "index": "2sec-siem-alerts",
          "notification": {
            "channels": ["security-alerts"],
            "priority": "high"
          }
        }
      },
      {
        "rule_id": "BEHAVIOR-SCAN-001",
        "name": "Web Scanning Activity",
        "description": "동일 IP에서 1분 내 30회 이상 스캐닝 시도 탐지",
        "severity": "medium",
        "category": "Reconnaissance",
        "query": {
          "bool": {
            "must": [
              {
                "term": {
                  "attack.rule_id": "WEB-SCAN-001"
                }
              }
            ],
            "filter": [
              {
                "range": {
                  "@timestamp": {
                    "gte": "now-1m"
                  }
                }
              }
            ]
          }
        },
        "aggregation": {
          "terms": {
            "field": "source.ip",
            "min_doc_count": 30
          }
        },
        "actions": {
          "alert": true,
          "index": "2sec-siem-alerts",
          "notification": {
            "channels": ["security-alerts"],
            "priority": "medium"
          }
        }
      },
      {
        "rule_id": "BEHAVIOR-404-001",
        "name": "Excessive 404 Errors - Reconnaissance",
        "description": "동일 IP에서 1분 내 30회 이상 404 에러 발생 - 디렉터리 브루트포스 의심",
        "severity": "medium",
        "category": "Reconnaissance",
        "query": {
          "bool": {
            "must": [
              {
                "term": {
                  "attack.rule_id": "WEB-404-001"
                }
              }
            ],
            "filter": [
              {
                "range": {
                  "@timestamp": {
                    "gte": "now-1m"
                  }
                }
              }
            ]
          }
        },
        "aggregation": {
          "terms": {
            "field": "source.ip",
            "min_doc_count": 30
          }
        },
        "actions": {
          "alert": true,
          "index": "2sec-siem-alerts",
          "notification": {
            "channels": ["security-alerts"],
            "priority": "medium"
          }
        }
      },
      {
        "rule_id": "BEHAVIOR-AUTH-001",
        "name": "Login Bruteforce Attack",
        "description": "동일 IP에서 1분 내 5회 이상 로그인 시도 - 브루트포스 공격 의심",
        "severity": "critical",
        "category": "Authentication Abuse",
        "query": {
          "bool": {
            "must": [
              {
                "term": {
                  "attack.rule_id": "WEB-AUTH-001"
                }
              }
            ],
            "filter": [
              {
                "range": {
                  "@timestamp": {
                    "gte": "now-1m"
                  }
                }
              }
            ]
          }
        },
        "aggregation": {
          "terms": {
            "field": "source.ip",
            "min_doc_count": 5
          }
        },
        "actions": {
          "alert": true,
          "index": "2sec-siem-alerts",
          "notification": {
            "channels": ["security-alerts", "security-critical"],
            "priority": "critical"
          },
          "response": {
            "block_ip": true,
            "duration": "1h"
          }
        }
      },
      {
        "rule_id": "BEHAVIOR-TIMEOUT-001",
        "name": "Slow Request Attack - DoS Indicator",
        "description": "동일 IP에서 5분 내 20회 이상 408 Timeout 발생 - Slowloris 계열 공격 의심",
        "severity": "high",
        "category": "Availability",
        "query": {
          "bool": {
            "must": [
              {
                "term": {
                  "attack.rule_id": "WEB-TIMEOUT-001"
                }
              }
            ],
            "filter": [
              {
                "range": {
                  "@timestamp": {
                    "gte": "now-5m"
                  }
                }
              }
            ]
          }
        },
        "aggregation": {
          "terms": {
            "field": "source.ip",
            "min_doc_count": 20
          }
        },
        "actions": {
          "alert": true,
          "index": "2sec-siem-alerts",
          "notification": {
            "channels": ["security-alerts"],
            "priority": "high"
          },
          "response": {
            "block_ip": true,
            "duration": "30m"
          }
        }
      },
      {
        "rule_id": "BEHAVIOR-MULTI-001",
        "name": "Multi-Vector Attack",
        "description": "동일 IP에서 여러 공격 유형 동시 시도 - 복합 공격 탐지",
        "severity": "critical",
        "category": "Multi-Stage",
        "query": {
          "bool": {
            "must": [
              {
                "exists": {
                  "field": "attack.rule_id"
                }
              }
            ],
            "filter": [
              {
                "range": {
                  "@timestamp": {
                    "gte": "now-5m"
                  }
                }
              }
            ]
          }
        },
        "aggregation": {
          "composite": {
            "sources": [
              {
                "source_ip": {
                  "terms": {
                    "field": "source.ip"
                  }
                }
              },
              {
                "attack_type": {
                  "terms": {
                    "field": "attack.category"
                  }
                }
              }
            ]
          }
        },
        "threshold": {
          "distinct_attack_types": 3
        },
        "actions": {
          "alert": true,
          "index": "2sec-siem-alerts",
          "notification": {
            "channels": ["security-alerts", "security-critical"],
            "priority": "critical"
          },
          "response": {
            "block_ip": true,
            "duration": "24h",
            "escalate": true
          }
        }
      }
    ]
  }
}
